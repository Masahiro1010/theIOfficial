{% extends "core/base.html" %}
{% load static %}

{% block title %}The.I - Remade To Be You{% endblock %}

{% block content %}
<article class="stage" id="stage">
    <!-- ① ヒーロー（ファーストビュー） -->
    <section class="hero pin" data-header-theme="dark">

        <video class="hero-bg" autoplay muted loop playsinline poster="{% static 'img/hero_fallback.jpg' %}">
            <source src="{% static 'movie/background.mp4' %}" type="video/mp4">
        </video>

        <!-- ★ 中央ロゴ（最初に表示 → 3秒後に消える） -->
        <div class="intro" aria-hidden="true">
            <img src="{% static 'img/thei_logo.png' %}" alt="" class="intro-logo">
        </div>
        
        <div class="hero-text">
            <img src="{% static 'img/thei_logo.png' %}" alt="The.I" class="hero-logo">
            <p class="hero-sub">Remade To Be You.</p>
        </div>
    </section>

    <!-- ② コンセプト（下から出てくるパネル） -->
    <section class="concept-panel" id="concept" data-header-theme="light">
        <div class="concept-inner container">
            <div class="row align-items-center g-5">

                <div class="col-12 col-lg-5 order-1 order-lg-2 mb-4 mb-lg-0">
                    <div class="concept-visual">
                        <img src="{% static 'img/JiaiConcept.jpeg' %}" alt="the.i" class="img-fluid">
                    </div>
                </div>

                <div class="col-12 col-lg-7 order-2 order-lg-1">
                    <h2 class="concept-eyebrow">Concept</h2>
                    <h3 class="concept-title">the.i（自愛）<br>自分を愛せるように、</h3>

                    <p class="concept-body">「the.i」のthe「i」はある共通のものを指します。</p>
                    <p class="concept-empty"></p>
                    <p class="concept-body">製作者と消費者を個でつなげるかけ合わせのかかわりの中で<br>自愛のごとく自分(identity)を愛するきっかけを作っていきます。</p>

                    <!--<a class="btn btn-outline-dark concept-btn" href="/shop/">ショップページはこちら</a>-->
                </div>
                
            </div>
        </div>
    </section>

    <!-- ②’ コンセプト直下：黒背景＋横3枚 -->
    <section class="concept-below concept-below--dark" id="concept-below" data-header-theme="dark">
        <div class="container">
            <div class="cb-slider" id="cb-slider">
                <button class="cb-nav cb-prev" aria-label="前へ" type="button">‹</button>
    
                <div class="cb-viewport">
                    <ul class="cb-track">
                        <li class="cb-slide">
                            <figure class="concept-thumb">
                                <div class="thumb-media">
                                    <img src="{% static 'img/picture01.jpeg' %}" alt="heavy weight long sleeve wide  pants" loading="lazy">
                                </div>
                                <figcaption class="concept-cap cap-reveal">"heavy weight "long sleeve wide  pants</figcaption>
                            </figure>
                        </li>
                        <li class="cb-slide">
                            <figure class="concept-thumb">
                                <div class="thumb-media">
                                    <img src="{% static 'img/picture02.jpeg' %}" alt="long sleeve fleece wide pants" loading="lazy">
                                </div>
                                <figcaption class="concept-cap cap-reveal">long sleeve fleece wide pants</figcaption>
                            </figure>
                        </li>
                        <li class="cb-slide">
                            <figure class="concept-thumb">
                                <div class="thumb-media">
                                    <img src="{% static 'img/picture03.jpeg' %}" alt="sculpted flare long sleeve sweat pants" loading="lazy">
                                </div>
                                <figcaption class="concept-cap cap-reveal">sculpted flare long sleeve sweat pants</figcaption>
                            </figure>
                        </li>
    
                        <!-- 必要に応じて以下を複製して枚数を増やす -->
                        <li class="cb-slide">
                            <figure class="concept-thumb">
                                <div class="thumb-media">
                                    <img src="{% static 'img/picture04.jpeg' %}" alt="patchwork sweat flare pants" loading="lazy">
                                </div>
                                <figcaption class="concept-cap cap-reveal">patchwork sweat flare pants</figcaption>
                            </figure>
                        </li>
                        <li class="cb-slide">
                            <figure class="concept-thumb">
                                <div class="thumb-media">
                                    <img src="{% static 'img/picture05.jpeg' %}" alt="long sleeve drape wide  pants" loading="lazy">
                                </div>
                                <figcaption class="concept-cap cap-reveal">long sleeve drape wide  pants</figcaption>
                            </figure>
                        </li>
                        <li class="cb-slide">
                            <figure class="concept-thumb">
                                <div class="thumb-media">
                                    <img src="{% static 'img/picture06.jpeg' %}" alt="up-down easy jogger pants" loading="lazy">
                                </div>
                                <figcaption class="concept-cap cap-reveal">up-down easy jogger pants</figcaption>
                            </figure>
                        </li>
                        <li class="cb-slide">
                            <figure class="concept-thumb">
                                <div class="thumb-media">
                                    <img src="{% static 'img/picture07.jpeg' %}" alt="patchwork layer  pants" loading="lazy">
                                </div>
                                <figcaption class="concept-cap cap-reveal">patchwork layer  pants</figcaption>
                            </figure>
                        </li>
                    </ul>
                </div>
    
                <button class="cb-nav cb-next" aria-label="次へ" type="button">›</button>
            </div>
            <!--
            <div class="more-link">
                <span>More</span>
            </div>
            -->
        </div>
    </section>
    
    
    

    <!-- =======================
    News セクション
    ======================= -->
    <section class="news-section" data-header-theme="light">
        <div class="container">
            <h2 class="news-title">News</h2>
            <ul class="news-list">
                <li class="news-item news-reveal">
                    <a class="is-disabled" href="/news/remake-wide-denim-20250905/">
                        <time datetime="2025-10-26" class="news-date">2025.10.26</time>
                        <span class="news-text">[The.I] ホームページ公開</span>
                    </a>
                </li>
                <li class="news-item news-reveal">
                    <a class="is-disabled" href="/news/popup-tenjin-20250902/">
                        <time datetime="2025-11-26" class="news-date">2025.11.30</time>
                        <span class="news-text">オンラインショップ開設予定</span>
                    </a>
                </li>
            </ul>
        </div>
    </section>
    
    <!-- =======================
    フッター
    ======================= -->
    <footer class="site-footer" data-header-theme="light">
        <div class="container footer-inner">
            <div class="footer-logo">
                <img src="{% static 'img/Jiai_logoFooter.png' %}" alt="The.I" class="footer-logo-img">
                <p class="slogan">Remade To Be You</p>
            </div>
    
            <!-- ★ ここを包み替え：住所とナビをひとまとめに -->
            <div class="footer-info">
                <div class="footer-contact">
                    <h3>お問い合わせ</h3>
                    <p>
                        〒600-8223<br>
                        京都府京都市下京区七条通油小路東入<br>
                        大黒町227番地第2キョートビル402<br>
                        Tell : 080-1920-6264
                    </p>
                </div>
    
                <!-- スマホでは住所の“横”に並ぶ -->
                <nav class="footer-nav footer-nav--compact" aria-label="フッターナビ">
                    <ul>
                        <li><a href="/">トップ</a></li>
                        <li><a href="/#concept">コンセプト</a></li>
                        <li><a href="/#images">イメージ</a></li>
                        <!--<li><a href="/news/">ニュース</a></li>-->
                    </ul>
                </nav>
            </div>
        </div>
    </footer>
    
    
</article>

<!-- ③ この先に続く通常コンテンツ -->
<section class="after-content">
    <!-- ここに他セクション -->
</section>
{% endblock %}

{% block extra_js %}
<script>
(function () {
    // ===== ロゴ：ページ表示時に左からフェードイン =====
    const logo = document.querySelector('.hero-logo');
    if (logo) {
        const fire = () => requestAnimationFrame(() => logo.classList.add('is-in'));
        if (logo.complete) { fire(); }
        else { logo.addEventListener('load', fire, { once: true }); }
    }

    // ===== コンセプト：下からせり上げ =====
    const stage = document.getElementById('stage');
    const concept = document.getElementById('concept');
    if (!stage || !concept) return;

    let ticking = false;
    const vh = () => window.innerHeight;
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    function update() {
        const startY = stage.offsetTop;         // ステージ開始位置
        const y = window.scrollY - startY;      // ステージ内のスクロール量
        const p = clamp(y / vh(), 0, 1);        // 0→1 でアニメ進行

        concept.style.transform = `translateY(${(1 - p) * 100}%)`;
        concept.style.opacity = (0.6 + p * 0.4).toFixed(3);

        if (p >= 1) concept.classList.add('is-sticky');
        else concept.classList.remove('is-sticky');

        ticking = false;
    }

    function onScroll(){ if (!ticking){ ticking = true; requestAnimationFrame(update); } }

    // 初期化（ヒーローが見える状態から開始）
    concept.classList.remove('is-sticky');
    concept.style.transform = 'translateY(100%)';
    concept.style.opacity = '0.6';
    update();

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', update);

    // ===== タイトル＆本文：画面中央帯に入ったらフェードイン =====
    (function setupConceptReveal() {
        const titleEl = document.querySelector('.concept-title');
        const bodyEls = Array.from(document.querySelectorAll('.concept-body'));

        // 監視ターゲットを集約（タイトル + 本文）
        const targets = [];
        if (titleEl) targets.push(titleEl);
        targets.push(...bodyEls);

        // 初期状態: 非表示スタイル（共通クラス）を付与
        targets.forEach((el) => el.classList.add('reveal-up'));

        // 画面中央だけを“当たり判定”にする：上下を45%ずつ削って中央10%をヒットゾーンに
        const observer = new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-in');
                    obs.unobserve(entry.target); // 1回だけ
                }
            });
        }, {
            root: null,
            rootMargin: '-45% 0% -45% 0%', // ← 中央バンド
            threshold: 0.001
        });

        targets.forEach(el => observer.observe(el));
    })();

    // ===== Concept-below のキャプション：画面下33%でフェードイン =====
    (function setupCaptionReveal() {
        const caps = Array.from(document.querySelectorAll('.concept-cap.cap-reveal'));
        if (!caps.length) return;

        // 当たり帯：上から67%付近（下から33%）を少し太めに
        const observer = new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-in');
                    obs.unobserve(entry.target); // 1回だけ
                }
            });
        }, {
            root: null,
            rootMargin: '-64% 0% -30% 0%', // ← 少し広げた（調整可）
            threshold: 0.001
        });

        // 連番で少し遅延させたい場合はこの1行を有効化
        // caps.forEach((el, i) => el.style.transitionDelay = `${i * 90}ms`);

        caps.forEach(el => observer.observe(el));
    })();

    // ===== Concept-below スライダー（3枚表示・1枚ずつ移動） =====
    (function setupCbSlider() {
        const root = document.getElementById('cb-slider');
        if (!root) return;

        const track    = root.querySelector('.cb-track');
        const slides   = Array.from(root.querySelectorAll('.cb-slide'));
        const prevBtn  = root.querySelector('.cb-prev');
        const nextBtn  = root.querySelector('.cb-next');
        const viewport = root.querySelector('.cb-viewport');

        // 表示枚数（既存ブレークポイント仕様を踏襲）
        const getSpv = () => {
            const w = window.innerWidth;
            if (w <= 575.98) return 1;
            if (w <= 991.98) return 2;
            return 3;
        };

        let index = 0;                 // 現在の「基準スライド」index
        let spv = getSpv();            // slides per view
        let dragging = false;
        let startX = 0, startY = 0, lastX = 0, lastT = 0, deltaX = 0;
        let baseOffsetPx = 0;          // 現在のトラック移動量(px) ※常に再計算でリセット
        const SWIPE_PX_THRESHOLD = 40;
        const VELOCITY_THRESHOLD = 0.5; // px/ms

        // スライド中心X（トラック左端を基準としたpx）
        function slideCenterX(i) {
            const el = slides[i];
            return el.offsetLeft + el.offsetWidth / 2;
        }

        // indexをビューポート中央にスナップした時の移動量(px)
        function offsetForIndex(i) {
            const center = slideCenterX(i);
            let target = center - viewport.clientWidth / 2; // 中央合わせ
            // 左右端をはみ出さないようにクランプ
            const max = Math.max(0, track.scrollWidth - viewport.clientWidth);
            if (target < 0) target = 0;
            if (target > max) target = max;
            return target;
        }

        // 実際にtransform適用（px）
        function applyOffset(px) {
            track.style.transform = `translate3d(${-px}px, 0, 0)`;
        }

        // indexやボタン状態を更新してスナップ
        function goTo(i) {
            spv = getSpv();
            root.style.setProperty('--spv', spv);

            // 端クランプ（spv>1でも「基準スライドを中央に」する）
            const maxIndex = slides.length - 1;
            index = Math.max(0, Math.min(i, maxIndex));

            const targetPx = offsetForIndex(index);
            baseOffsetPx = targetPx;

            track.style.transition = 'transform .45s cubic-bezier(.22,1,.36,1)';
            applyOffset(baseOffsetPx);
            setTimeout(() => { track.style.transition = ''; }, 460);

            // ナビ活性/非活性はお好みで（中央合わせ時は端に達しているかで判断）
            prevBtn.disabled = (baseOffsetPx <= 0 + 0.5);
            nextBtn.disabled = (baseOffsetPx >= (track.scrollWidth - viewport.clientWidth - 0.5));

            // 見えているキャプションはフェードイン
            const leftEdge = baseOffsetPx;
            const rightEdge = baseOffsetPx + viewport.clientWidth;
            slides.forEach((li) => {
                const cap = li.querySelector('.concept-cap.cap-reveal');
                if (!cap) return;
                const liLeft = li.offsetLeft;
                const liRight = liLeft + li.offsetWidth;
                if (liRight > leftEdge && liLeft < rightEdge) cap.classList.add('is-in');
            });
        }

        // 現在オフセットから「中央に一番近いスライドindex」を推定
        function nearestIndex() {
            const centerInTrack = baseOffsetPx + viewport.clientWidth / 2;
            let best = 0, bestDist = Infinity;
            for (let i = 0; i < slides.length; i++) {
                const c = slideCenterX(i);
                const d = Math.abs(c - centerInTrack);
                if (d < bestDist) { bestDist = d; best = i; }
            }
            return best;
        }

        // 初期レイアウト
        function recalc() {
            spv = getSpv();
            root.style.setProperty('--spv', spv);
            // 現在の位置から最寄りスライドを取り直してセンタリング
            index = nearestIndex();
            baseOffsetPx = offsetForIndex(index);
            applyOffset(baseOffsetPx);

            prevBtn.disabled = (baseOffsetPx <= 0 + 0.5);
            nextBtn.disabled = (baseOffsetPx >= (track.scrollWidth - viewport.clientWidth - 0.5));
        }

        // イベント
        window.addEventListener('resize', () => {
            // リサイズ時は位置ズレが出やすいので、改めてセンタリング
            baseOffsetPx = offsetForIndex(index);
            applyOffset(baseOffsetPx);
            recalc();
        }, { passive: true });

        prevBtn.addEventListener('click', () => goTo(index - 1));
        nextBtn.addEventListener('click', () => goTo(index + 1));

        // ---- フリック（Pointer Events）----
        function onPointerDown(e) {
            if (e.pointerType === 'mouse' && e.button !== 0) return;
            dragging = true;
            startX = lastX = e.clientX;
            startY = e.clientY;
            lastT = performance.now();
            deltaX = 0;
            track.style.transition = '';
            viewport.classList.add('grabbing');
            viewport.setPointerCapture?.(e.pointerId);
        }

        function onPointerMove(e) {
            if (!dragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            // 横意図が強い時のみ介入
            if (Math.abs(dx) > Math.abs(dy)) {
                e.preventDefault();
                deltaX = dx;
                applyOffset(baseOffsetPx - deltaX);
                lastX = e.clientX;
                lastT = performance.now();
            }
        }

        function onPointerUp(e) {
            if (!dragging) return;
            dragging = false;
            viewport.classList.remove('grabbing');
            viewport.releasePointerCapture?.(e.pointerId);

            const totalDx = e.clientX - startX;
            const dt = Math.max(1, performance.now() - lastT);
            const velocity = Math.abs(totalDx) / dt;

            // 基本は1枚送り。勢い/距離で決定
            let next = index;
            if (Math.abs(totalDx) > SWIPE_PX_THRESHOLD || velocity > VELOCITY_THRESHOLD) {
                next = index + (totalDx < 0 ? 1 : -1);
            }

            // 最終的に「中央に最も近いスライド」を選ぶ（はみ出し補正）
            next = Math.max(0, Math.min(next, slides.length - 1));
            goTo(next);
        }

        viewport.addEventListener('pointerdown', onPointerDown, { passive: true });
        viewport.addEventListener('pointermove', onPointerMove, { passive: false });
        viewport.addEventListener('pointerup', onPointerUp, { passive: true });
        viewport.addEventListener('pointercancel', onPointerUp, { passive: true });

        // 起動
        recalc();
    })();

    // ===== News：画面下から20%付近でフェードイン =====
    (function setupNewsReveal() {
        const items = Array.from(document.querySelectorAll('.news-item.news-reveal'));
        if (!items.length) return;

        // 画面下から20%のライン付近に“薄い当たり帯（約4%）”を作る
        // rootMargin: top right bottom left（%はビューポート比）
        const observer = new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-in');
                    obs.unobserve(entry.target); // 1回だけ
                }
            });
        }, {
            root: null,
            rootMargin: '-76% 0% -20% 0%',  // ← 上76%/下20%を削って、下から20%付近に約4%の帯
            threshold: 0.001
        });

        items.forEach(el => observer.observe(el));
    })();

})();
</script>

<script>
    (function () {
        const hero = document.querySelector('.hero');
        const intro = document.querySelector('.intro');
        const introLogo = document.querySelector('.intro-logo');
        const finalLogo = document.querySelector('.hero-logo');
    
        if (!hero || !intro || !introLogo || !finalLogo) return;
    
        const HOLD_MS = 3000;   // 中央表示時間
        const FADE_MS = 600;    // フェード時間（CSSと合わせる）
    
        // ★ 念のため：開始時に“見せる系”クラスを外し、左下ロゴの早出を防止
        hero.classList.remove('text-on', 'video-on');
        finalLogo.classList.remove('is-in');
    
        const whenReady = (img) => img.complete
            ? Promise.resolve()
            : new Promise((r) => img.addEventListener('load', r, { once: true }));
    
        whenReady(introLogo).then(() => {
            requestAnimationFrame(() => {
                // 中央ロゴフェードイン
                intro.classList.add('is-on');
    
                // 3秒保持 → フェードアウト → その後に動画&左下ロゴを出す
                setTimeout(() => {
                    intro.classList.add('is-out');
    
                    setTimeout(() => {
                        // 背景動画ON
                        hero.classList.add('video-on');
                        // 左下テキストON
                        hero.classList.add('text-on');
                        // 左下ロゴのスライドイン
                        finalLogo.classList.add('is-in');
                        // イントロ除去
                        intro.remove();
                    }, FADE_MS);
                }, HOLD_MS);
            });
        });
    })();
</script>
{% endblock %}



